<!DOCTYPE html>
<!--[if (lte IE 7)&!(IEMobile)]> <html xmlns:fb="http://www.facebook.com/2008/fbml" lang="sv" class="no-js ieLte8 ieLte7 "> <![endif]-->
<!--[if (IE 8)&!(IEMobile)]> <html xmlns:fb="http://www.facebook.com/2008/fbml" lang="sv" class="no-js ieLte8 "> <![endif]-->
<!--[if IE 9 ]> <html lang="sv" class="no-js ie9 "> <![endif]-->
<!--[if IEMobile]> <html lang="sv" class="no-js ieMobile "> <![endif]-->
<!--[if (gt IE 9)|!(IE)]><!--> <html lang="sv" class="no-js "><!--<![endif]-->
<html>
<head>
    <meta charset="UTF-8">
    <meta name="Author" content="Sveriges Television AB, Stockholm, Sweden" />
    <meta name="Robots" content="index, follow, noarchive" />
    <meta name="Googlebot" content="index, follow, noarchive" />
    <meta name="viewport" content="user-scalable=no, initial-scale=1.0, maximum-scale=1.0, width=device-width" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="format-detection" content="telephone=no" />

    <meta property="og:title" content="Refugee flows to the EU" />
    <meta property="og:site_name" content="SVT Nyheter – Pejl" />
    <meta property="og:url" content="http://pejl.svt.se/flyktingstrommar-en" />
    <meta property="og:description" content="Click on a country of origin to see where the refugees went in the European Union." />
    <meta property="og:image" content="http://pejl.svt.se/img/flyktingstrommar.png" />

    <!--[IEMobile]>  <meta name="MobileOptimized" content="width" /> <![endif]-->
    <title>SVT Pejl</title>
    <link rel="shortcut icon" href="/img/favicon-nyheter.ico"/>
    <!-- TODO: Add touch icons -->
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-46253867-1', 'auto');
      ga('send', 'pageview');

    </script>
</head>
<body>
    <!-- Mobile viewport optimized: j.mp/bplateviewport -->
<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1">
<!--[IEMobile]> <meta name="MobileOptimized" content="width" /> <![endif]-->
    <link rel="shortcut icon" href="http://www.svt.se/statiskt/skins/svt/css/img/favicon/favicon-nyheter.ico"/>
<link rel="apple-touch-icon" sizes="72x72" href="http://www.svt.se/statiskt/skins/svt/css/img/favicon/apple-touch-icon-57x57-nyheter.png"/>
<link rel="apple-touch-icon" sizes="114x114" href="http://www.svt.se/statiskt/skins/svt/css/img/favicon/apple-touch-icon-nyheter.png"/>
    
    <!--[if (gt IE 8)|(IEMobile)|!(IE)]><!-->
<!--     <link rel="stylesheet" type="text/css" href="/static/css/svt/svtse.css"/>
    <link rel="stylesheet" type="text/css" href="/static/css/svt/svtse_mq.css"/>
    <link rel="stylesheet" type="text/css" href="/static/css/svt/theme-svtpejl.css"/> -->
    <!--<![endif]-->
    <!--[if (lte IE 8)&!(IEMobile)]>
    <link rel="stylesheet" type="text/css" href="/static/css/svt/svtse_ieLte8.css"/>
    <link rel="stylesheet" type="text/css" href="/static/css/svt/svtse_mq_ieLte8.css"/>
    <link rel="stylesheet" type="text/css" href="/static/css/svt/theme-svtpejl_ieLte8.css"/>
    <![endif]-->
    <!-- <script src="http://www.svt.se/statiskt/js/libs/modernizr.custom.827662.js" type="text/javascript"></script>
    <script src="http://www.svt.se/statiskt/js/libs/modernizr.esitests.13.05.js" type="text/javascript"></script> -->
    <!--[if (gt IE 8)|(IEMobile)|!(IE)]><!-->
<link rel="stylesheet" type="text/css" href="http://www.svt.se/statiskt/skins/svt/css/nss_core.css"/>
<link rel="stylesheet" type="text/css" href="http://www.svt.se/statiskt/skins/svt/css/nss_core_mq.css"/>
<link rel="stylesheet" type="text/css" href="http://www.svt.se/statiskt/skins/svt/css/nss.css"/>
<link rel="stylesheet" type="text/css" href="http://www.svt.se/statiskt/skins/svt/css/themes/nss-theme-svtpejl.css"/>
<!--<![endif]-->
<!--[if (lte IE 8)&!(IEMobile)]>
<link rel="stylesheet" type="text/css" href="http://www.svt.se/statiskt/skins/svt/css/nss_core_ieLte8.css"/>
<link rel="stylesheet" type="text/css" href="http://www.svt.se/statiskt/skins/svt/css/nss_core_mq_ieLte8.css"/>
<link rel="stylesheet" type="text/css" href="http://www.svt.se/statiskt/skins/svt/css/nss_ieLte8.css"/>
<link rel="stylesheet" type="text/css" href="http://www.svt.se/statiskt/skins/svt/css/themes/nss-theme-svtpejl_ieLte8.css"/>
<![endif]-->
<script src="http://www.svt.se/statiskt/js/libs/modernizr.custom.71900.js" type="text/javascript"></script>
<script src="http://www.svt.se/statiskt/js/libs/modernizr.esitests.13.06.js" type="text/javascript"></script>
    
	<link rel="stylesheet" href="http://pejl.svt.se/lib/css/pejl.css" />
	<link rel="stylesheet" href="http://pejl.svt.se/lib/css/valu.css" />
	<link rel="stylesheet" href="http://pejl.svt.se/flyktingstrommar-en/css/style.04c5b46f317db1f389f51dc0d2ac35ec.css" />


<script type="text/javascript">
window.regionpickerUseNewNames = false;
</script>

    <div class="document">
        <div class="svtContainerBase svtContainerBase-svtpejl">
            <div id="primary" class="svtContainerMain svtContainerMain-svtpejl">
                
	


                
	<div class="valu-fallback">
	  <p>För att se den interaktiva grafiken måste du ha JavaScript aktiverat, och använda en modern webbläsare som exempelvis Google Chrome, Mozilla Firefox eller Internet Explorer 9 och uppåt. <a href="http://browsehappy.com/?locale=sv_SE">Läs mer här</a>.</p>
	</div>

	<div id="flowchart" class="valu-interactive" tabindex="-1">
		<h5 class="flowchart-dynamic-title"></h5>
		<h5 class="flowchart-label  flowchart-label--from">Origin</h5>
		<h5 class="flowchart-label  flowchart-label--to">Recipient</h5>
	</div>
         
           
        </div>
    </div>
   
    <script type="text/javascript" src="http://www.svt.se/statiskt/js/libs/responsive-images.js"></script>
<script src="http://www.svt.se/statiskt/js/libs/noScript.js" type="text/javascript"></script>
<script type="text/javascript">
if (NoScript.hasNoScriptMode() === false) {
<!-- Load JSON if not set before -->
if (typeof window.JSON === 'undefined') {
document.write('<script src="http://www.svt.se/statiskt/js/libs/json2.js"><\/script>');
}
}
</script>
<!-- Grab Google CDN's jQuery. fall back to local if necessary -->
<script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
<script>window.jQuery || document.write('<script src="http://www.svt.se/statiskt/js/libs/jquery-1.11.1.min.js"><\/script>')</script>
<div style="display:none;" class="svt_js-env" data-js-env-svtse-api="http://svtse-api.svti.svt.se"></div>
<script type="text/javascript">
if (NoScript.hasNoScriptMode() === false) {
<!-- Loads all Javascript except standalone -->
document.write('<script src="http://www.svt.se/statiskt/js/script-nss-built.js"><\/script>');
}
</script>
<!--[if lt IE 9]>
<script type="text/javascript" src="http://www.svt.se/statiskt/js/libs/innershiv.js"></script>
<![endif]-->
<!--[if lt IE 7]>
<script type="text/javascript" src="http://www.svt.se/statiskt/js/libs/dd_belatedpng.js"></script>
<script type="text/javascript"> DD_belatedPNG.fix('img, .png_bg'); //fix any <img> or .png_bg background-images </script>
<![endif]-->
    
	<script src="http://pejl.svt.se/lib/js/pejl.js"></script>
	<script src="http://cdnjs.cloudflare.com/ajax/libs/d3/3.5.3/d3.min.js"></script>
	<script src="http://pejl.svt.se/lib/js/valu.js"></script>
	<script>
	
	
var dataNode = d3.select('#flowchart');
var nodeData = JSON.parse(JSON.parse(dataNode.attr('data-valu')));

var tip = d3.select('body').append('div')
    .attr('class', 'tooltip')
    .style('opacity', 0);

// var tip2 = d3.select('body').append('div')
//     .attr('class', 'tooltip2')
//     .style('opacity', 0);

function keepInView(num) {
  var viewWidth = window.innerWidth,
    tipWidth = parseInt(tip2.style('width'));

  if (num < 1) return 0;
  if (num > viewWidth - tipWidth) return viewWidth - tipWidth - 20;
  return num;
}

var format = d3.format(",d");

d3.json('flyktingstrommar_en.json', function(nodeData) {
  // Extend Underscore
  _.indexWhere = function(list, prop) {
    var obj = _.findWhere(list, prop);
    return _.indexOf(list, obj);
  };

  function getPercentage(id, val) {
    var targets = _.where(nodeData.links, {source: id});
    var sum = _.reduce(targets, function(memo, obj) { return memo + obj.value; }, 0);
    return (val / sum * 100).toFixed(1);
  }

  function getTotal(id) {
    var targets = _.where(nodeData.links, {source: id});
    var sum = _.reduce(targets, function(memo, obj) { return memo + obj.value; }, 0);
    return sum;
  }

  function getCountries(source, target) {
    var s = _.findWhere(nodeData.nodes2010, { _id: source }).name;
    var t = _.findWhere(nodeData.nodes2014, { _id: target }).name;
    return [s, t];
  }

  // State holding object
  var state = {
    movingForward: null,
    currentObject: null,
    currentSorting: null,
    currentLinks: null
  };

  // Dimensions
  var w = parseInt(d3.select('#flowchart').style('width')),
    h = parseInt(d3.select('#flowchart').style('height')) - 50,
    boxPadding = 10,
    boxSize = 25,
    p = boxSize * 4;

  // TEMP, DO CHANGE THIS LATER
  if (typeof stripped !== 'undefined') {
    boxPadding = 20;
    boxSize = 50;
  }

  // Scales
  // var colorDomain = [1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18],
  //   colorRange = ['#b02522','#c13b38','#acc768','#78ae5a',
  //     '#378cab','#366da3','#88c7d9','#e7d960','#b9527d',
  //     '#b02522','#c13b38','#acc768','#78ae5a','#378cab',
  //     '#366da3','#88c7d9','#e7d960','#b9527d'];

  // var colors = d3.scale.ordinal()
  //   .domain(colorDomain)
  //   .range(colorRange);

  var linkWidth = d3.scale.linear()
    .domain([1, 96.5])
    .range([3, boxSize]);

  // Path generators for curved lines
  var diagonalStart = function(data) {
    var nodes = checkDirection(leftBoxes.data(), rightBoxes.data()),
      node = _.findWhere(nodes, { _id: data._id }),
      order = data.sortedIndex + 1 || nodes.indexOf(node) + 1,
      coords = {
        x: order * boxSize + (order - 1) * boxPadding - boxSize / 2,
        y: checkDirection(boxSize + p, w - (p + boxSize))
      };

    return d3.svg.diagonal()
      .source(function() { return coords; })
      .target(function() { return coords; })
      .projection(function(d) { return [d.y, d.x]; });
  };

  var diagonalEnd = function(data) {
    return d3.svg.diagonal()
      .source(function() {
        var nodes = checkDirection(leftBoxes.data(), rightBoxes.data());
        var source = _.findWhere(nodes, { _id: data._id });
        var order = data.sortedIndex + 1 || nodes.indexOf(source) + 1;

        return {
          'x': order * boxSize + (order - 1) * boxPadding - boxSize / 2,
          'y': checkDirection(boxSize * 4, w - (p + boxSize))
        };
      })
      .target(function(d) {
        var order = _.indexWhere(state.currentSorting, { _id: d.target }) + 1;

        return {
          'x': order * boxSize + (order - 1) * boxPadding - boxSize / 2,
          'y': data._id >= 29 ? boxSize + p : w - (p + boxSize + 22)
        };
      })
      .projection(function(d) { return [d.y, d.x]; });
  };

  // Append the links 
  function appendLinkstoNodes(nodesArray) {
    _.each(nodesArray, function(nodes) {
      _.each(nodes, function(d) {
        var links = _.where(nodeData.links, { source: d._id });

        d.links = {};

        _.each(links, function (e) {
          d.links[e.target] = e.value;
        });
      });
    });
  }

  appendLinkstoNodes([nodeData.nodes2010, nodeData.nodes2014]);

  var svg = d3.select('#flowchart').append('svg')
    .attr('width', w)
    .attr('height', h);

  // Create the party boxes
  var leftBoxes = svg.append('g')
    .attr('class', 'left-boxes')
    .selectAll('.left-box')
    .data(nodeData.nodes2010)
    .enter()
    .append('g')
    .attr('transform', function(d, i) {
      return 'translate(' + 0 + ',' + i * (boxSize + boxPadding) + ')';
    })
    .attr('class', 'left-box');

    leftBoxes.append('svg:title')
      .text(function(d) { return d._short.toUpperCase(); });

    leftBoxes.append('rect')
    .attr({
      'width': boxSize * 4,
      'height': boxSize,
      'class': function(d) {
        return 'party-box party-box-left ' + d._short.replace('Ã¶','o');
      }
    })
    .on("mousemove", function(d) {
        var x = d3.event.target.getBoundingClientRect().right;
        var y = d3.event.target.getBoundingClientRect().top;
        d3.select(this).style('opacity', 0.8);
        //   tip2.transition()
        //       .duration(200)
        //       .style("opacity", 1);
        //   tip2 .html(d.name)
        //       .style('left', x + "px")
        //       .style("top", $(d3.event.target).offset().top + "px");
        })
    .on("mouseout", function(d) {
        d3.select(this).style('opacity', 1);
        // tip2.transition()
        //     .duration(500)
        //     .style("opacity", 0);
    });

    leftBoxes.append('text')
    .text(function(d) { return d.name; })
    .attr('class', 'party-short')
    .attr('dy', function() {
      return typeof stripped !== 'undefined' ? '2em' : '1.4em';
    })
    .attr('dx', 3);

  var rightBoxes = svg.append('g')
    .attr('class', 'right-boxes')
    .selectAll('.right-box')
    .data(nodeData.nodes2014)
    .enter()
    .append('g')
    .attr('class', 'right-box')
    .attr('transform', function(d, i) {
      return 'translate(' + (w - (p + boxSize + 22)) + ',' +
                        i * (boxSize + boxPadding) + ')';
    });

    rightBoxes.append('svg:title')
      .text(function(d) { return d._short.toUpperCase(); });

    rightBoxes.append('rect')
    .attr({
      'width': boxSize * 4,
      'height': boxSize,
      'class': function(d) { return 'party-box ' + d._short.replace('Ã¶','o'); }
    })
    .on("mousemove", function(d) {
        // var x = d3.event.target.getBoundingClientRect().left - parseInt(tip2.style('width'));
        // var y = d3.event.target.getBoundingClientRect().top;
        d3.select(this).style('opacity', 0.8);
          // tip2.transition()
          //     .duration(200)
          //     .style("opacity", 1);
          // tip2 .html(d.name)
          //     .style('left', x + "px")
          //     .style("top", $(d3.event.target).offset().top + "px");
        })
    .on("mouseout", function(d) {
        d3.select(this).style('opacity', 1);
        // tip2.transition()
        //     .duration(500)
        //     .style("opacity", 0);
    });

    rightBoxes.append('text')
    .text(function(d) { return d.name; })
    .attr('class', 'party-short')
    .attr('dy', function() {
      return typeof stripped !== 'undefined' ? '2em' : '1.4em';
    })
    .attr('dx', 3);

  leftBoxes.on('click', function(d) {
    VR.Router.navigate(d._short + '2010');
  });

  // rightBoxes.on('click', function(d) {
  //   VR.Router.navigate(d._short + '2014');
  // });

  // Updates state values and calls updating functions
  function update(e) {
    state.currentObject = e;
    state.movingForward = e._id >= 29 ? false : true;
    state.currentSorting = sortOpposite(e);
    state.currentLinks = nodeData.links.filter(function(d) {
      return d.source === e._id;
    });

    updateLinks(e);
    updateBoxOrder(state.currentSorting);
    updatePercentages(e);
    updateTitle(e);
  }

  // Draw the links
  function updateLinks(e) {
    var strokeWidth = function(d) {
      var percent = getPercentage(d.source, d.value);
      return d.value > 0.1 ? linkWidth(percent) + 'px' : '0px';
    };

    // Make sure the thickest link is displayed first
    state.currentLinks = state.currentLinks.sort(function(a, b) {
      return b.value - a.value;
    });

    var DOMLinks = svg.selectAll('.link')
      .data(state.currentLinks);

    DOMLinks
      .transition()
      .attr('stroke-width', strokeWidth)
      .attr('d', diagonalStart(e))
      .transition()
      .delay(function(d, i) { return i * 80 + 1000; })
      .ease('quad')
      .duration(300)
      .attr('d', diagonalEnd(e));

    DOMLinks
      .enter()
      .append('path')
      .attr('stroke', '#5A7558')
      .attr('d', diagonalStart(e))
      .transition()
      .delay(function(d, i) { return i * 80 + 1000; })
      .ease('quad')
      .duration(300)
      .attr('class', 'link')
      .attr('d', diagonalEnd(e))
      .attr('fill', 'none')
      .attr('stroke-width', strokeWidth);
    
    DOMLinks
      .on("mousemove", function(d) {
          var countries = getCountries(d.source, d.target);
          d3.select(this).style('opacity', 0.8);
            tip.transition()
                .duration(200)
                .style("opacity", 1);
            tip .html(format(d.value) + 'K Dollars from ' + countries[0] + ' Dept to ' + countries[1] + '.')
                .style('left', d3.event.pageX - 90 + "px")
                .style("top", (d3.event.pageY - 28) + "px");
          })
      .on("mouseout", function(d) {
          d3.select(this).style('opacity', 1);
          tip.transition()
              .duration(500)
              .style("opacity", 0);
      });

    DOMLinks.exit().remove();
  }

  function updatePercentages() {
    var percentageLabels = svg.selectAll('.percentage-label')
      .data(state.currentLinks);

    percentageLabels
      .text(function(d) { return getPercentage(d.source, d.value) + '%'; })
      .attr('x', function() { return  w - 40; })
      .transition()
      .duration(1000)
      .attr('y', function(d) {
        var targetOrder = _.indexWhere(state.currentSorting, { _id: d.target }) + 1;
        return targetOrder * (boxSize + boxPadding) - 43;
      });

    percentageLabels.enter()
      .append('text')
      .attr('x', function() { return w - 40; })
      .attr('y', function(d) {
        var targetOrder = _.indexWhere(state.currentSorting, { _id: d.target }) + 1;
        return targetOrder * (boxSize + boxPadding) - 43;
      })
      .attr('dy', function() {
        return typeof stripped !== 'undefined' ? '0.6em' : '1.9em';
      })
      .attr('class', 'percentage-label')
      .text(function(d) { return getPercentage(d.source, d.value) + '%'; });

    percentageLabels.exit().remove();
  }

  function updateTitle(e) {
    var title = d3.select('.flowchart-dynamic-title');

    title.text(function() {
      if (state.movingForward) {
        if (e._short === 'ou' || e._short === 'slÃ¶') {
          return 'There are ' + format(getTotal(e._id)) + 'K Dollars from ' + e.name.toLowerCase() + ' Dept moved to USA.';
        } else {
          return 'There are ' + format(getTotal(e._id)) + 'K Dollars from ' + e.name + ' Dept moved to USA.';
        }
      }
    });
  }

  // Performs the actual reordering of boxes on the other side
  function updateBoxOrder(sortedData) {
    var c = checkDirection('.right-box', '.left-box'),
      x = checkDirection(w - (p + boxSize + 22), p);

    var updatingBoxes = svg.selectAll(c)
      .data(sortedData, function(d) { return d.name; });

    updatingBoxes
      .transition()
      .duration(1000)
      .attr('transform', function(d, i) {
        return 'translate(' + x + ',' + i * (boxSize + boxPadding) + ')';
      });
  }

  // Sorts box data on the other side based on the clicked box
  function sortOpposite(box) {
    var targetBoxes = checkDirection(rightBoxes, leftBoxes);

    // Sort the data based on current object data
    var sortedData = targetBoxes
      .data()
      .sort(function(a, b) {
        return box.links[b._id] - box.links[a._id];
      });

    // Create an index property for later use
    _.each(sortedData, function(d, i) {
      d.sortedIndex = i;
    });

    return sortedData;
  }

  function checkDirection(forward, backward) {
    return state.movingForward ? forward : backward;
  }

  // Make the chart responsive
  d3.select(window).on('resize', function() {
    w = parseInt(d3.select('#flowchart').style('width'));
    h = parseInt(d3.select('#flowchart').style('height'));

    svg.attr('width', w)
      .attr('height', h);

    svg.selectAll('.percentage-label')
      .attr('x', function() { return  w - 40; });

    svg.selectAll('.right-box').attr('transform', function() {
      var yTranslate = d3.select(this)
          .attr('transform')
          .match(/,[0-9]+/)
          .shift()
          .replace(',','');
      return 'translate(' + (w - (p + boxSize + 22)) + ',' + yTranslate + ')';
    });

    svg.selectAll('.link')
      .attr('d', diagonalEnd(state.currentObject));
  });


  // Create routes for every partybox
  for (var i = 0, n = nodeData.nodes2010; i < n.length; i++) {
    VR.Router.add(n[i]._short + '2010', function() {
      var a = n[i];
      return function() {
        update(a);
      };
    }(i));
  }

  for (var i = 0, n = nodeData.nodes2014; i < n.length; i++) {
    VR.Router.add(n[i]._short + '2014', function() {
      var a = n[i];
      return function() {
        update(a);
      };
    }(i));
  }

  // Listen to hash changes
  VR.Router.listen();

  // We need to execute once on pageload
  if (VR.Router.route) VR.Router.execute();
});
	
	
	</script>


    <!-- Start SiteCatalyst -->
    <script type="text/javascript">
        $(document).ready(function() {
            svt.core.statistics.logSiteCatalystStatistics("http://svt.d3.sc.omtrdc.net/b/ss/svtdev/1/H.25.4--NS/1382709546124?pageName=svtse%3ANyheter%3APejl%3A/flyktingstrommar-en&ch=Nyheter&c2=Nyheter%3A&c3=Nyheter%3A%3APejl&c7=Nyheter&c8=http%3A//pejl.svt.se/flyktingstrommar-en&c9=svt.se");
        });
    </script>
         
    <noscript>
        <img src="http://svt.d3.sc.omtrdc.net/b/ss/svtdev/1/H.25.4--NS/1382709546124?pageName=svtse%3ANyheter%3APejl%3A/flyktingstrommar-en%3Aindex&ch=Nyheter&c2=Nyheter%3A&c3=Nyheter%3A%3APejl&c7=Nyheter&c8=http%3A//pejl.svt.se/flyktingstrommar-en&c9=svt.se" width="1" height="1" alt=""/>
    </noscript>
    <!-- End SiteCatalyst -->

    <!-- Start Orvesto -->
    <script type="text/javascript">
    $(document).ready(function() {
        svt.core.statistics.logOrvestoStatistics("?Sajt=svtse&Sektion=Nyheter&Undersektion1=Pejl&Undersektion2=index&Typ=panelonlywebb");
    });
    </script>
    <!-- End Orvesto -->
</body>
</html>